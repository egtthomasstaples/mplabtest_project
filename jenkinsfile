pipeline{
    agent('any')
    stages {
        stage('Power On Virtual Machine')
        {
            agent('any')
            steps
            {
                sh"""
                #!/bin/bash
                    doctl compute droplet-action power-on 364671951
                """
                echo "success"
            }
        }
        stage('Checkout from SCM') {
            agent {label 'Linux'}
            steps {
                agent {
                docker
                {
                    alwaysPull false
                    reuseNode true
                    image 'mplabx-5.25_xc16-1.36'
                }  
                }
                checkout scm
                sh """
                #!/bin/bash
                    /opt/microchip/mplabx/v5.25/mplab_platform/bin/prjMakefilesGenerator.sh -f ./mplab_second_project.X
                    cd mplab_second_project.X/
                    ls
                    /opt/microchip/mplabx/v5.25/mplab_platform/bin/make clean
                    /opt/microchip/mplabx/v5.25/mplab_platform/bin/make --always-make all
                    ls
                    cp dist/default/production/mplab_second_project.X.production.hex $WORKSPACE/test_release.hex
                """
                archiveArtifacts artifacts: 'test_release.hex'

                // sh "ls"
                // // Generate make files 
                // sh "/opt/microchip/mplabx/v5.25/mplab_platform/bin/prjMakefilesGenerator.sh -f ./mplab_second_project.X"
                // // Clean output directory. 
                // sh "cd mplab_second_project.X/"
                // sh "ls"
                // sh "/opt/microchip/mplabx/v5.25/mplab_platform/bin/make ./mplab_second_project.X/clean"
                // // Build all targets
                // sh "/opt/microchip/mplabx/v5.25/mplab_platform/bin/make ./mplab_second_project.X/ --always-make all"

                // sh "ls"
                // sh "echo hello"
            }
        }
    }
}